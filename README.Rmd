---
output:
  github_document:
    fig_width: 12
    fig_height: 10
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = FALSE, message = FALSE, echo = FALSE}
library(magrittr)
```

# hrgraphsign
```
Simplifies analysis of hr-graph data based on the six signatures
from this article: https://hbr.org/2018/11/better-people-analytics

```

## Installation
```
devtools::install_github("mrtnnrdlnd/hrgraphsign")
```

## Background
There are measures of employees performance which can't be measured in isolation.
Six of these measures are mentioned in the article: 

> **Better People Analytics**
> Measure who they know, not just who they are. **by Paul Leonardi and Noshir Contractor**

This package is an attempt to make these six measures a little easier to use in practice.
The measures is referred to as signatures in the article and so they will be here.
They are, in order of appearance:

1. **Ideation Signature** - Individual level measure
2. **Influence Signature** - Individual level measure
3. **Efficiency Signature** - Team level measure
4. **innovation Signature** - Team level measure
5. **Silo Signature** - Organizational level measure
6. **Vulnerability Signature** Organizational level measure

## The Signatures by example
Before getting to the actual signatures we load some example data and create a connected network from it

### Example Data

```{r, warning = FALSE, message = FALSE}
# nodes will be representing the employees
nodes <- readxl::read_excel("example/nodes.xlsx")
# Look at data
knitr::kable(nodes %>% head(5))
```

```{r, warning = FALSE, message = FALSE}
# edges will be representing the relations between the employees
edges <- readxl::read_excel("example/edges.xlsx")
# Look at data
knitr::kable(edges %>% head(5))
```

### Create Graph

```{r, warning = FALSE, message = FALSE}
example_graph <- edges %>% 
  dplyr::select(FromID, ToID, everything()) %>%
  igraph::graph_from_data_frame(directed = FALSE, vertices = nodes) %>% 
  hrgraphsign::aggregate_edges()
```

### Individual level

#### Ideation Signature
Predicts, according to the article, which employees will come up with good ideas
```{r, warning = FALSE, message = FALSE}
# Get ideation measure
igraph::V(example_graph)$ideation <- hrgraphsign::ideation_signature(example_graph)
# Display Top 3 For Ideation
knitr::kable(hrgraphsign::get_top_by_column(example_graph, column = "ideation", n = 3))
```

#### Influence Signature
Predicts, according to the article, Which employees will change othersâ€™ behavior
```{r, warning = FALSE, message = FALSE}
# Get influence measure
igraph::V(example_graph)$influence <- hrgraphsign::influence_signature(example_graph)
# Display Top 3 For Influence
knitr::kable(hrgraphsign::get_top_by_column(example_graph, column = "influence", n = 3))
```

#### Comparison
```{r, warning = FALSE, message = FALSE}
set.seed(5)
layout1 <- igraph::layout.fruchterman.reingold(example_graph)
par(mfrow = c(1,2))
plot(example_graph,
     edge.width = igraph::E(example_graph)$weights,
     vertex.color = hrgraphsign::vertices_colors(example_graph, attribute = "department"),
     vertex.size = hrgraphsign::vertices_sizes(example_graph, attribute = "ideation"),
     main = "Ideation",
     layout = layout1
     )
plot(example_graph,
     edge.width = igraph::E(example_graph)$weights,
     vertex.color = hrgraphsign::vertices_colors(example_graph, attribute = "department"),
     vertex.size = hrgraphsign::vertices_sizes(example_graph, attribute = "influence"),
     main = "Influence",
     layout = layout1
)
```

### Efficiency signature
Predicts, according to the article, Which teams will complete projects on time.

The efficiency signature is a combination of a team with high cohesion, or density, and
at the same time have high external range which means having members that are well connected outside the team.

In the implementation here it is assumed that the number of vertices connected to the team, up to three steps away, is an okey measure of external range.

```{r, warning = FALSE, message = FALSE}
# Create subgraph for efficiency measure
team_graph <- example_graph %>%
  igraph::induced_subgraph(., igraph::V(.)[igraph::V(.)$department == "Engineering"])
# Get measure
team_efficiency <- hrgraphsign::efficiency_signature(example_graph, team_graph)
```


### Display top 10 
```{r, warning = FALSE, message = FALSE}
knitr::kable(hrgraphsign::get_top_by_column(example_graph, column = "ideation", n = 10))
```

### Plot graph

```{r, warning = FALSE, message = FALSE}
set.seed(5)
layout1 <- igraph::layout.fruchterman.reingold(example_graph)
par(mfrow = c(1,2))
plot(example_graph,
     edge.width = igraph::E(example_graph)$weights,
     vertex.color = hrgraphsign::vertices_colors(example_graph, attribute = "department"),
     vertex.size = hrgraphsign::vertices_sizes(example_graph, attribute = "ideation"),
     main = "Ideation",
     layout = layout1
     )
plot(example_graph,
     edge.width = igraph::E(example_graph)$weights,
     vertex.color = hrgraphsign::vertices_colors(example_graph, attribute = "department"),
     vertex.size = hrgraphsign::vertices_sizes(example_graph, attribute = "influence"),
     main = "Influence",
     layout = layout1
)
```

### Plot friends_friends

```{r, warning = FALSE, message = FALSE}

par(mfrow = c(1,2))
subgraph <- hrgraphsign::friends_friends(example_graph, 13, 2)
set.seed(10)
layout2 <- igraph::layout.fruchterman.reingold(subgraph)
  plot(subgraph,
       edge.width = igraph::E(example_graph)$weights,
       vertex.color = hrgraphsign::vertices_colors(subgraph, attribute = "department"),
       vertex.size = hrgraphsign::vertices_sizes(subgraph, attribute = "ideation"),
       main = "Ideation",
       layout = layout2
  )
  plot(subgraph,
       edge.width = igraph::E(example_graph)$weights,
       vertex.color = hrgraphsign::vertices_colors(subgraph, attribute = "department"),
       vertex.size = hrgraphsign::vertices_sizes(subgraph, attribute = "influence"),
       main = "Influence",
       layout = layout2
  )
```
